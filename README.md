# Reading Microservices

åŸºäºGoçš„é˜…è¯»åº”ç”¨å¾®æœåŠ¡æ¶æ„ - å®Œæ•´ç‰ˆæœ¬

## æ¶æ„æ¦‚è¿°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client Apps   â”‚
â”‚ (iOS/Android)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Gateway   â”‚
â”‚      (Gin)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Microservices Architecture              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   User Service  â”‚ Content Service â”‚  Reading Service    â”‚
â”‚     :8081       â”‚     :8082       â”‚     :8083           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç”¨æˆ·è®¤è¯        â”‚ â€¢ å°è¯´ç®¡ç†       â”‚ â€¢ é˜…è¯»è®°å½•          â”‚
â”‚ â€¢ ç¬¬ä¸‰æ–¹ç™»å½•      â”‚ â€¢ ç« èŠ‚ç®¡ç†       â”‚ â€¢ ä¹¦æ¶ç®¡ç†          â”‚
â”‚ â€¢ ç”¨æˆ·ä¿¡æ¯        â”‚ â€¢ åˆ†ç±»æ ‡ç­¾       â”‚ â€¢ æ”¶è—è¯„è®º          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Payment Serviceâ”‚ Notification Svcâ”‚ Download Service    â”‚
â”‚     :8084       â”‚     :8085       â”‚     :8086           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ VIPç®¡ç†        â”‚ â€¢ æ¨é€é€šçŸ¥       â”‚ â€¢ ç¦»çº¿ä¸‹è½½          â”‚
â”‚ â€¢ ç§¯åˆ†é˜…è¯»å¸      â”‚ â€¢ é€šçŸ¥è®¾ç½®       â”‚ â€¢ ä»»åŠ¡ç®¡ç†          â”‚
â”‚ â€¢ ç­¾åˆ°ç¤¼å“        â”‚ â€¢ æ¶ˆæ¯é˜Ÿåˆ—       â”‚ â€¢ æ–‡ä»¶å­˜å‚¨          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Infrastructure                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     MySQL       â”‚      Redis      â”‚      Consul         â”‚
â”‚     :3306       â”‚      :6379      â”‚      :8500          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ å·²å®ç°çš„åŠŸèƒ½

### 1. ç”¨æˆ·æœåŠ¡ (User Service) - ç«¯å£ 8081
- âœ… ç”¨æˆ·æ³¨å†Œ/ç™»å½•
- âœ… JWT Tokenè®¤è¯
- âœ… ç¬¬ä¸‰æ–¹ç™»å½•æ”¯æŒ
- âœ… ç”¨æˆ·ä¿¡æ¯ç®¡ç†
- âœ… ä¼šè¯ç®¡ç†

### 2. å†…å®¹æœåŠ¡ (Content Service) - ç«¯å£ 8082
- âœ… å°è¯´ç®¡ç† (CRUD)
- âœ… ç« èŠ‚ç®¡ç† (CRUD)
- âœ… åˆ†ç±»/æ ‡ç­¾ç®¡ç†
- âœ… å†…å®¹æœç´¢
- âœ… ç»Ÿè®¡æ•°æ®

### 3. é˜…è¯»æœåŠ¡ (Reading Service) - ç«¯å£ 8083
- âœ… é˜…è¯»è®°å½•ç®¡ç†
- âœ… ä¹¦æ¶åŠŸèƒ½ (åœ¨è¯»/æ”¶è—/ä¸‹è½½)
- âœ… è¯„è®ºç³»ç»Ÿ
- âœ… æœç´¢å†å²
- âœ… é˜…è¯»ç»Ÿè®¡

### 4. æ”¯ä»˜ä¼šå‘˜æœåŠ¡ (Payment Service) - ç«¯å£ 8084
- âœ… VIPä¼šå‘˜ç®¡ç†
- âœ… ç§¯åˆ†ç³»ç»Ÿ
- âœ… é˜…è¯»å¸ç®¡ç†
- âœ… ç­¾åˆ°ç³»ç»Ÿ
- âœ… ç¤¼å“/å…‘æ¢ç ç³»ç»Ÿ
- âœ… é’±åŒ…ç®¡ç†

### 5. é€šçŸ¥æœåŠ¡ (Notification Service) - ç«¯å£ 8085
- âœ… é€šçŸ¥ç®¡ç†
- âœ… é€šçŸ¥è®¾ç½®
- âœ… æ¨é€Tokenç®¡ç†
- âœ… æ‰¹é‡é€šçŸ¥

### 6. ä¸‹è½½æœåŠ¡ (Download Service) - ç«¯å£ 8086
- âœ… ä¸‹è½½ä»»åŠ¡ç®¡ç†
- âœ… ç¦»çº¿ä¸‹è½½
- âœ… æ–‡ä»¶æ ¼å¼æ”¯æŒ (TXT/EPUB/PDF)
- âœ… ä¸‹è½½è¿›åº¦è·Ÿè¸ª

### 7. APIç½‘å…³ (API Gateway) - ç«¯å£ 8080
- âœ… ç»Ÿä¸€å…¥å£
- âœ… è·¯ç”±åˆ†å‘
- âœ… è®¤è¯æˆæƒ
- âœ… é™æµä¿æŠ¤
- âœ… å¥åº·æ£€æŸ¥

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **Language**: Go 1.21+
- **Framework**: Gin
- **ORM**: GORM
- **Database**: MySQL 8.0
- **Cache**: Redis 6.0
- **Service Discovery**: Consul
- **Config**: Viper + YAML
- **Logging**: Logrus
- **Container**: Docker + Docker Compose
- **Authentication**: JWT

## ğŸ“ é¡¹ç›®ç»“æ„

```
reading-microservices/
â”œâ”€â”€ api-gateway/          # APIç½‘å…³æœåŠ¡
â”œâ”€â”€ user-service/         # ç”¨æˆ·æœåŠ¡
â”œâ”€â”€ content-service/      # å†…å®¹æœåŠ¡
â”œâ”€â”€ reading-service/      # é˜…è¯»æœåŠ¡
â”œâ”€â”€ payment-service/      # æ”¯ä»˜ä¼šå‘˜æœåŠ¡
â”œâ”€â”€ notification-service/ # é€šçŸ¥æœåŠ¡
â”œâ”€â”€ download-service/     # ä¸‹è½½æœåŠ¡
â”œâ”€â”€ shared/              # å…±äº«ç»„ä»¶
â”‚   â”œâ”€â”€ config/          # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ middleware/      # ä¸­é—´ä»¶
â”‚   â””â”€â”€ go.mod
â”œâ”€â”€ deployments/         # éƒ¨ç½²é…ç½®
â”‚   â””â”€â”€ docker/          # Dockeré…ç½®
â”œâ”€â”€ scripts/             # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ go.mod              # æ ¹æ¨¡å—
â””â”€â”€ README.md
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚
- **å¼€å‘ç¯å¢ƒ (Windows)**: Docker Desktop, Go 1.21+
- **ç”Ÿäº§ç¯å¢ƒ (Linux)**: Docker, Docker Compose, 2GB+ RAM

### 2. å¼€å‘ç¯å¢ƒå¯åŠ¨ (Windows)

#### æ–¹å¼1: ä½¿ç”¨æ‰¹å¤„ç†æ–‡ä»¶ (æ¨è)
```cmd
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
start.bat

# å¼€å‘æ¨¡å¼ (ä»…å¯åŠ¨åŸºç¡€è®¾æ–½)
dev.bat

# åœæ­¢æ‰€æœ‰æœåŠ¡
stop.bat
```

#### æ–¹å¼2: ä½¿ç”¨Makeå‘½ä»¤
```cmd
make start   # å¯åŠ¨æ‰€æœ‰æœåŠ¡
make dev     # å¼€å‘æ¨¡å¼
make stop    # åœæ­¢æœåŠ¡
```

#### æ–¹å¼3: æ‰‹åŠ¨å¼€å‘æ¨¡å¼
```cmd
# å¯åŠ¨åŸºç¡€è®¾æ–½
dev.bat

# ç„¶ååœ¨ä¸åŒç»ˆç«¯å¯åŠ¨å„ä¸ªæœåŠ¡
cd user-service && go run main.go
cd content-service && go run main.go
cd reading-service && go run main.go
cd payment-service && go run main.go
cd notification-service && go run main.go
cd download-service && go run main.go
cd api-gateway && go run main.go
```

### 3. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½² (Linux)

```bash
# å…‹éš†é¡¹ç›®åˆ°LinuxæœåŠ¡å™¨
git clone <repository-url>
cd reading-microservices

# ä¸€é”®éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
chmod +x scripts/*.sh
sudo ./scripts/deploy.sh

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
./scripts/status.sh

# æ•°æ®å¤‡ä»½
./scripts/backup.sh
```

## ğŸ“Š æœåŠ¡ç«¯ç‚¹

| æœåŠ¡ | ç«¯å£ | å¥åº·æ£€æŸ¥ | æè¿° |
|------|------|----------|------|
| API Gateway | 8080 | `/health` | ç»Ÿä¸€å…¥å£ |
| User Service | 8081 | `/health` | ç”¨æˆ·ç®¡ç† |
| Content Service | 8082 | `/health` | å†…å®¹ç®¡ç† |
| Reading Service | 8083 | `/health` | é˜…è¯»åŠŸèƒ½ |
| Payment Service | 8084 | `/health` | æ”¯ä»˜ä¼šå‘˜ |
| Notification Service | 8085 | `/health` | é€šçŸ¥æ¨é€ |
| Download Service | 8086 | `/health` | ä¸‹è½½ç®¡ç† |

### åŸºç¡€è®¾æ–½
- **Consul UI**: http://localhost:8500
- **MySQL**: localhost:3306
- **Redis**: localhost:6379

## ğŸ”Œ APIæ–‡æ¡£

### è®¤è¯æµç¨‹
```bash
# 1. ç”¨æˆ·æ³¨å†Œ
curl -X POST http://localhost:8080/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "password123",
    "platform": "web"
  }'

# 2. ç”¨æˆ·ç™»å½•
curl -X POST http://localhost:8080/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "password123",
    "platform": "web"
  }'

# 3. ä½¿ç”¨Tokenè®¿é—®å—ä¿æŠ¤çš„API
curl -X GET http://localhost:8080/api/v1/user/profile \
  -H "Authorization: Bearer <token>"
```

### ä¸»è¦APIç«¯ç‚¹

#### ç”¨æˆ·ç›¸å…³
- `POST /api/v1/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/v1/auth/login` - ç”¨æˆ·ç™»å½•
- `GET /api/v1/user/profile` - è·å–ç”¨æˆ·ä¿¡æ¯
- `PUT /api/v1/user/profile` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯

#### å†…å®¹ç›¸å…³
- `GET /api/v1/content/novels/search` - æœç´¢å°è¯´
- `GET /api/v1/content/novels/:id` - è·å–å°è¯´è¯¦æƒ…
- `GET /api/v1/content/novels/:novel_id/chapters` - è·å–ç« èŠ‚åˆ—è¡¨

#### é˜…è¯»ç›¸å…³
- `POST /api/v1/reading/progress` - æ›´æ–°é˜…è¯»è¿›åº¦
- `GET /api/v1/reading/bookshelf` - è·å–ä¹¦æ¶
- `POST /api/v1/reading/favorites/:novel_id` - æ·»åŠ æ”¶è—

#### æ”¯ä»˜ç›¸å…³
- `POST /api/v1/payment/checkin` - æ¯æ—¥ç­¾åˆ°
- `GET /api/v1/payment/wallet` - è·å–é’±åŒ…ä¿¡æ¯
- `POST /api/v1/payment/vip` - è´­ä¹°VIP

## ğŸ“‹ å‘½ä»¤å‚è€ƒ

### Windowså¼€å‘ç¯å¢ƒ
```cmd
# æ‰¹å¤„ç†æ–‡ä»¶å‘½ä»¤
start.bat          # å¯åŠ¨æ‰€æœ‰æœåŠ¡
dev.bat           # å¼€å‘æ¨¡å¼ (ä»…åŸºç¡€è®¾æ–½)
stop.bat          # åœæ­¢æ‰€æœ‰æœåŠ¡

# Makeå‘½ä»¤ (éœ€è¦å®‰è£…make)
make help          # æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
make build         # æ„å»ºæ‰€æœ‰æœåŠ¡
make start         # å¯åŠ¨æ‰€æœ‰æœåŠ¡ (è‡ªåŠ¨æ£€æµ‹Windows)
make stop          # åœæ­¢æ‰€æœ‰æœåŠ¡
make dev           # å¯åŠ¨å¼€å‘ç¯å¢ƒ
make clean         # æ¸…ç†Dockerèµ„æº
make test          # è¿è¡Œæµ‹è¯•
```

### Linuxç”Ÿäº§ç¯å¢ƒ
```bash
# éƒ¨ç½²è„šæœ¬
./scripts/deploy.sh   # ä¸€é”®éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒ
./scripts/status.sh   # æ£€æŸ¥æœåŠ¡çŠ¶æ€
./scripts/backup.sh   # æ•°æ®å¤‡ä»½
./scripts/start.sh    # å¯åŠ¨æœåŠ¡ (å¸¦å¥åº·æ£€æŸ¥)
./scripts/stop.sh     # åœæ­¢æœåŠ¡
./scripts/dev.sh      # å¼€å‘æ¨¡å¼

# Docker Composeå‘½ä»¤
docker-compose up -d --build    # å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose ps               # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose logs -f          # æŸ¥çœ‹æ—¥å¿—
docker-compose down             # åœæ­¢æœåŠ¡
```

## ğŸ”§ é…ç½®è¯´æ˜

æ¯ä¸ªæœåŠ¡éƒ½æœ‰ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ `config.yaml`ï¼Œä¸»è¦é…ç½®é¡¹ï¼š

```yaml
server:
  name: "service-name"
  host: "localhost"
  port: 8081

database:
  host: "localhost"
  port: 3306
  username: "root"
  password: "password"
  database: "reading_app"

redis:
  host: "localhost"
  port: 6379
  db: 0

jwt:
  secret: "reading-app-secret-key"
  expires_in: 86400
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æœåŠ¡å¯åŠ¨å¤±è´¥**
   ```bash
   # æ£€æŸ¥æ—¥å¿—
   docker-compose logs <service-name>

   # æ£€æŸ¥ç«¯å£å ç”¨
   netstat -tlnp | grep :8080
   ```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥MySQLæœåŠ¡
   docker-compose logs mysql

   # æ‰‹åŠ¨è¿æ¥æµ‹è¯•
   mysql -h localhost -P 3306 -u root -p
   ```

3. **Redisè¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥RedisæœåŠ¡
   docker-compose logs redis

   # æµ‹è¯•è¿æ¥
   redis-cli ping
   ```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ•°æ®åº“ä¼˜åŒ–**
   - åˆç†ä½¿ç”¨ç´¢å¼•
   - ä¼˜åŒ–æŸ¥è¯¢è¯­å¥
   - é…ç½®è¿æ¥æ± 

2. **ç¼“å­˜ç­–ç•¥**
   - çƒ­ç‚¹æ•°æ®ç¼“å­˜
   - æŸ¥è¯¢ç»“æœç¼“å­˜
   - åˆ†å¸ƒå¼é”

3. **æœåŠ¡ä¼˜åŒ–**
   - å¼‚æ­¥å¤„ç†
   - æ‰¹é‡æ“ä½œ
   - é™æµä¿æŠ¤

## ğŸ”’ å®‰å…¨è¯´æ˜

- JWT Tokenè¿‡æœŸæ—¶é—´: 24å°æ—¶
- å¯†ç é‡‡ç”¨bcryptåŠ å¯†
- APIé™æµä¿æŠ¤
- CORSè·¨åŸŸé…ç½®
- è¾“å…¥å‚æ•°éªŒè¯

## ğŸ“ å¼€å‘è§„èŒƒ

1. **ä»£ç è§„èŒƒ**
   - éµå¾ªGoå®˜æ–¹è§„èŒƒ
   - ä½¿ç”¨gofmtæ ¼å¼åŒ–
   - æ·»åŠ å¿…è¦æ³¨é‡Š

2. **Gitè§„èŒƒ**
   - feat: æ–°åŠŸèƒ½
   - fix: ä¿®å¤bug
   - docs: æ–‡æ¡£æ›´æ–°
   - refactor: é‡æ„

3. **æµ‹è¯•è§„èŒƒ**
   - å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 70%
   - é›†æˆæµ‹è¯•
   - APIæµ‹è¯•

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤ä»£ç 
4. å‘èµ·Pull Request

## ğŸ“„ è®¸å¯è¯

MIT License

---

**é¡¹ç›®çŠ¶æ€**: âœ… å®Œæˆ
**ç‰ˆæœ¬**: v1.0.0
**æœ€åæ›´æ–°**: 2025-01-21